import K from"./modules/kaigen/kaigen.js";import currencies from"./assets/js/currencies.js";import geojson from"./assets/geojson/countryBorders.geo.js";import cats from"./assets/js/mainCategories.js";import allCats from"./assets/js/categories.js";import colours from"./assets/js/colours.js";const attributions={bootstrap:{img:"./assets/images/attribution/bootstrap.png",href:"https://getbootstrap.com/"},esri:{img:"./assets/images/attribution/esriworldimages.png",href:"https://www.esri.com"},geoapify:{img:"./assets/images/attribution/geoapify.png",href:"https://www.geoapify.com"},geonames:{img:"./assets/images/attribution/geonames.png",href:"https://www.geonames.org"},gnews:{img:"./assets/images/attribution/gnews.png",href:"https://gnews.io"},jawg:{img:"./assets/images/attribution/jawgmaps.png",href:"http://jawg.io"},leaflet:{img:"./assets/images/attribution/leafletjs.png",href:"https://leafletjs.com"},openExchange:{img:"./assets/images/attribution/openexchangerates.png",href:"https://openexchangerates.org"},openWeather:{img:"./assets/images/attribution/openweather.png",href:"https://www.openweather.org"},thunderforest:{img:"./assets/images/attribution/thunderforest.png",href:"https://www.thunderforest.com"}},tiles=[{name:"primary",img:"./assets/images/primary.png",key:"fvlhZyGiTztkqcQiO7ymVbhnINKH1ym3JjaKyBLHcmu28wCg5lts8D6rbjpYGQit",href:"https://tile.jawg.io/jawg-sunny/{z}/{x}/{y}.png?access-token=",attribution:'<a href="http://jawg.io" data-bs-toggle="tooltip" title="Tiles Courtesy of Jawg Maps" target="_blank" class="jawg-attrib">&copy; <b>Jawg</b>Maps</a> | <a href="https://www.openstreetmap.org/copyright" data-bs-toggle="tooltip" title="OpenStreetMap is open data licensed under ODbL" target="_blank" class="osm-attrib">&copy; OSM contributors</a>'},{name:"terrain",img:"./assets/images/terrain.png",key:"0983b35182f944bf84d692bcae8fbc89",href:"https://tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey=",attribution:'<a href="https://www.thunderforest.com/" data-bs-toggle="tooltip" title="Tiles Courtesy of Thunderforest Maps" target="_blank" class="jawg-attrib">&copy; <b>Thunderforest</b>Maps</a> | <a href="https://www.openstreetmap.org/copyright" data-bs-toggle="tooltip" title="OpenStreetMap is open data licensed under ODbL" target="_blank" class="osm-attrib">&copy; OSM contributors</a>'},{name:"dark",key:"0983b35182f944bf84d692bcae8fbc89",img:"./assets/images/dark.png",href:"https://tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png?apikey=",attribution:'<a href="https://www.thunderforest.com/" data-bs-toggle="tooltip" title="Tiles Courtesy of Thunderforest Maps" target="_blank" class="jawg-attrib">&copy; <b>Thunderforest</b>Maps</a> | <a href="https://www.openstreetmap.org/copyright" data-bs-toggle="tooltip" title="OpenStreetMap is open data licensed under ODbL" target="_blank" class="osm-attrib">&copy; OSM contributors</a>'},{name:"satellite",img:"./assets/images/satellite.png",href:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:'<a href="https://www.arcgis.com/" data-bs-toggle="tooltip" title="Tiles Courtesy of Esri World Imagery" target="_blank" class="jawg-attrib">&copy; <b>Esri </b>World Imagery</a> | <a href="https://www.openstreetmap.org/copyright" data-bs-toggle="tooltip" title="OpenStreetMap is open data licensed under ODbL" target="_blank" class="osm-attrib">&copy; OSM contributors</a>'}],backendHost="https://www.aidanklee.co.uk";let map=null,baseLayers={},markerLayerGroup=null,businessLayerGroup=L.markerClusterGroup({maxClusterRadius:40}),location=null,locationMarkerLatLng=null,handleZoomEnd=null,centre={},found=!1,currentCountry="",currentCurrency="",currentExchangeRates=null,geoLayer=null,moveTimeout=null,searchTimeout=null,selectedCategories=[];const head=$("head"),favicon=$('<link rel="icon" type="image/png" href="./assets/images/logo192.png"/>'),appletouchicon=$('<link rel="apple-touch-icon" sizes="192x192" type="image/png" href="./assets/images/logo192.png">'),preloader=$("#preloader"),root=$("#root"),mapContainer=$('<div id="map"></div>'),categoryContainer=$('<div id="categories"></div>'),crosshair=$('<svg id="crosshair" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-crosshair"><circle cx="12" cy="12" r="10"></circle><line x1="22" y1="12" x2="18" y2="12"></line><line x1="6" y1="12" x2="2" y2="12"></line><line x1="12" y1="6" x2="12" y2="2"></line><line x1="12" y1="22" x2="12" y2="18"></line></svg>'),loader=$('<div id="loader" class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>'),topControls=$('<div class="controls top"></div>'),bottomLeftControls=$('<div class="controls bottom-left"></div>'),bottomRightControls=$('<div class="controls bottom-right"></div>'),topLeftControls=$('<div class="left"></div>'),topRightControls=$('<div class="right"></div>'),zoomControls=$('<div id="zoom-control" class="btn-group-vertical shadows-light"></div>'),zoomIn=$('<button class="btn btn-primary border" type="button" data-bs-toggle="tooltip" title="Zoom In"></button>'),zoomOut=$('<button class="btn btn-light border" type="button" data-bs-toggle="tooltip" title="Zoom Out"></button>'),moreInfo=$('<button id="more-info" class="btn btn-secondary border mb-0" data-bs-toggle="tooltip" title="More Info"></button>'),myLocation=$('<button id="my-location" class="btn btn-secondary border round shadows-light" data-bs-toggle="tooltip" title="My Location"></button>'),outline=$('<button id="geolayer" class="btn btn-light border round active" data-bs-toggle="tooltip" title="My Location"></button>'),crosshairButton=$('<button id="crosshair-button" class="btn btn-light border round active shadows" data-bs-toggle="tooltip" title="Crosshair"></button>'),baseLayerControl=$('<div id="base-layer-control"></div>'),baseLayerControlDropdown=$('<div class="collapse"></div>'),collapse=new bootstrap.Collapse(baseLayerControlDropdown,{toggle:!1}),searchBarContainer=$('<div id="search-bar-container" class="mb-2 rounded-pill"></div>'),searchBar=$('<div id="search-bar" class="input-group shadows"></div>'),countrySelect=$('<select id="country" class="form-select" aria-label=" aria-label="Country Select"></select>'),searchLabel=$('<label for="country" class="btn btn-light border" data-bs-toggle="tooltip" title="Search"></label>'),maximize='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-maximize"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>',minmize='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-minimize"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path></svg>',fullscreenButton=$('<button class="btn btn-secondary" type="button" data-bs-toggle="tooltip" title="Full Screen"></button>'),toastContainer=$('<div class="toast-container"></div>'),weatherContainer=$('<div id="weather-container" data-bs-toggle="tooltip" class="btn btn-light mb-1 rounded d-flex align-items-center shadows-light border" title="Weather"></div>'),weatherIcon=$('<img src="" alt="" />'),weatherholder='<div class="placeholder-glow"><span class="placeholder col-12"></span></div>',weatherholder2=weatherholder.slice(),currentAddressMarker=$('<div class="alert alert-light d-flex align-items-center border shadows-light" role="alert"></div>'),icon='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-map-pin"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',placeholder='<div class="placeholder-glow"><span class="placeholder col-12"></span></div>',placeholder2=placeholder.slice(),placeholders=$('<div class="placeholders"></div>'),moreInfoMenu=$('<div id="more-info-menu" class="rounded-end border-end border-2 shadows-light collapse"></div>'),moreInfoCollape=new bootstrap.Collapse(moreInfoMenu[0],{toggle:!1}),info=$('<div id="info"></div>'),infoHeader=$('<header class="modal-header"></header>'),infoHeaderText=$('<h1 class="fs-2 fw-semibold mb-0"></div>'),infoClose=$('<button type="button" class="btn-close" aria-label="Close"></button>'),infoBody=$('<div class="modal-body"></div>'),addressList=$('<h2 class="modal-title mb-0 fs-5">Address</h2>'),formattedAddress=$("<p></p>"),countryState=$('<h2 class="modal-title mb-0 fs-4"></h2>'),countryInfo=$('<table class="table table-striped table-hover"></table>'),continent=$("<tr></tr>"),capital=$("<tr></tr>"),population=$("<tr></tr>"),areaSqKm=$("<tr></tr>"),menuWeather=$('<div class="weather d-flex border mb-3"></div>'),newsArticles=$('<div class="news"></div>'),currencyList=$('<div class="currency mb-3"></div>'),wikis=$('<div class="wiki"></div>'),infoFooter=$('<div class="modal-footer d-block"></div>'),powered=$('<p class="fw-bold text-center mb-2">Powered By</p>'),attrib=$('<div id="attribution" class ="d-flex justify-content-center"></div>');let clickTimeout=null,clickCount=0;const categories={},allCategories={};let colourIndex=0;cats.forEach((e=>{e.colour=colours[colourIndex],categories[e.alias]=e,colourIndex=9===colourIndex?0:colourIndex+1})),allCats.categories.forEach((e=>allCategories[e.alias]=e));const renderNoLocation=()=>{const e=$('<div class="location modal fade" tabindex="-1"></div>'),t=$('<div class="modal-dialog modal-dialog-centered"></div>'),a=$('<div class="modal-content"></div>'),o=$('<div class="modal-header"></div>'),r=$('<h5 class="modal-title">Location Services</h5>'),s=$('<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'),n=$('<div class="modal-body"><p>You didn\'t enable your location services or they\'re not available on your device. We aim to tailor your experience based on your location.</p><p class="mb-0">If you want the best experience enable your location and click below or refresh your page. If not, feel free to XPlore!</p></div>'),i=$('<div class="modal-footer"></div>'),l=$('<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>'),c=$('<button type="button" class="btn btn-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg></button>');root.append(e),e.append(t),t.append(a),a.append(o,n,i),o.append(r,s),i.append(l,c);new bootstrap.Modal(e[0]).show(),getCurrentLocation(),c.on("click",(e=>{window.location.reload()}))},renderCategorySelector=()=>{categoryContainer.on("mousewheel",(e=>{categoryContainer[0].scrollLeft+=e.originalEvent.deltaY})),root.append(categoryContainer);for(let e in categories){e=categories[e];const t=$(`<button class="btn btn-sm ${e.colour} d-flex align-items-center rounded-pill border-0" value="${e.alias}"><i class="fa-solid ${e.icon} me-2"></i><p class="mb-0">${e.title}</p></button>`);categoryContainer.append(t),t.on("click",(a=>{if(t.toggleClass("active"),t.hasClass("active")){if(selectedCategories.push(e.alias),map.getZoom()<=10){const e=(locationMarkerLatLng||map.getCenter()).toBounds(4e4);map.fitBounds(e)}}else selectedCategories=selectedCategories.filter((t=>t!==e.alias));getBusinesses(L.latLng(centre.data.lat,centre.data.lon),{categories:selectedCategories.join(",")},(e=>{addBusinessMarkers(e)}))}))}},renderMenuWeather=async e=>{const t=e[0],a=e.slice(1),o=$('<div class="left"></div>'),r=$('<div class="right"></div>'),s=$('<div class="top d-flex"></div>'),n=$('<div class="bottom"></div>'),i=async(e,t,a)=>{const{description:o,feels_like:r,humidity:s,icon:n,pressure:i,temp:l,temp_max:c,temp_min:d}=t;let p=await fetch(`http://openweathermap.org/img/w/${n}.png`);p=await p.blob(),p=URL.createObjectURL(p),e.empty();const u=$('<img src="" alt="" />');u.attr("src",p),u.attr("alt",o),e.append(u,`<div class="day">${a||t.day.slice(0,3)}</div>`,`<div class="temp bold">${Math.round(K.kelToCel(l))}<sup>°C</sup></div>`)};menuWeather.empty(),menuWeather.append(o,r),r.append(s,n),n.append(`<p>Real Feel: ${Math.round(K.kelToCel(t.feels_like))}<sup>°C</sup>.</p><p>${K.toTitle(t.description)}</p><p>Humidity: ${t.humidity}%</p>`),i(o,t,"Today"),a.forEach((e=>{const t=$("<div></div>");s.append(t),i(t,e)}))},renderExchangeRates=e=>{const{currency:t,rates:a}=e;currencyList.empty();const o=$(`<h2 class="d-flex align-items-center overflow-hidden">${t} <span class="d-inline badge rounded-pill bg-primary fw-semibold fs-6 ms-2">${currencies[t]}</span></h2>`),r=$("<div class='select-rates'></div>");["USD","EUR","JPY","GBP","AUD","CAD"].forEach((e=>{const t=$('<div class="d-flex pb-1"></div>'),a=$(`<input disabled class="rate" value="${currentExchangeRates[e].toFixed(5)}" />`),o=$('<select class="form-select form-select-sm rounded-pill"></select>');o.on("change",(e=>{a.val(currentExchangeRates[e.currentTarget.value].toFixed(5))})),r.append(t),t.append(a,o),Object.keys(currencies).forEach((t=>{o.append($(`<option value="${t}"${e===t?" selected":""}>${t}: ${currencies[t]}</option>`))}))})),currencyList.append(o,r)},renderWikis=async(e=[])=>{wikis.empty();const t=$('<h2 class="fs-5">Wikipedia</h2>'),a=$('<div id="wiki" class="carousel carousel-dark slide" data-bs-ride="true"></div>'),o=$('<div class="carousel-indicators">'),r=$('<div class="carousel-inner">'),s=$('<button class="carousel-control-prev" type="button" data-bs-target="#wiki" data-bs-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="false"></span><span class="visually-hidden">Previous</span></button>'),n=$('<button class="carousel-control-next" type="button" data-bs-target="#wiki" data-bs-slide="next"><span class="carousel-control-next-icon" aria-hidden="false"></span><span class="visually-hidden">Next</span></button>');if(wikis.append(t,a),a.append(o,r,s,n),e.length>0)e.forEach(((e,t)=>{const a=$(`<button type="button" data-bs-target="#wiki" data-bs-slide-to="${t}"${0===t?' class="active" aria-current="true"':""} aria-label="Slide 1"></button>`),s=$(`<figure class="card px-5 pb-3 rounded-3 bg-light bg-gradient carousel-item${0===t?" active":""}"></figure>`),n=$(`<div class="card-body"><h5 class="card-title">${e.title}</h5><p class="card-text">${e.summary}</p><a class="stretched-link" href="https://${e.wikipediaUrl}" target="_blank" class="row g-0"><p class="card-text"><small class="text-muted">${e.wikipediaUrl}</small></p></a></div>`);o.append(a),r.append(s),s.append(n)}));else{const e=$('<button type="button" data-bs-target="#wiki" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>'),t=$('<figure class="card px-5 pb-3 rounded-3 bg-light bg-gradient carousel-item active"></figure>'),a=$('<div class="card-body"><h5 class="card-title">No Wikipedia Links</h5><p class="card-text">There\'s no Wikipedia links available for the current location. Try zooming out, viewing a wider area may find more results.</p><a class="stretched-link" href="#" target="_blank" class="row g-0"><p class="card-text"><small class="text-muted"></small></p></a></div>');o.append(e),r.append(t),t.append(a)}},renderMenuAddress=e=>{infoHeaderText.html(e.address_line1),formattedAddress.html(`${e.address_line1}${e.city?`, ${e.city}`:""}${e.county?`, ${e.county}`:""}${e.postcode?`, ${e.postcode}`:""}`),countryState.html(`${e.country?e.country:e.address_line1}${e&&e.state&&e.state.includes("-Capital")||!e.state?"":`, <span class="fs-6">${e.state}</span>`}`)},renderCountryData=e=>{continent.html(`<th class="fw-semibold p-2">Continent</th><td class="text-end p-2">${e.continentName}</td>`),capital.html(`<th class="fw-semibold p-2">Capital City</th><td class="text-end p-2">${e.capital}</td>`),population.html(`<th class="fw-semibold p-2">Population</th><td class="text-end p-2">${formatBigInt(e.population)}</td>`),areaSqKm.html(`<th class="fw-semibold p-2">Land Area</th><td class="text-end p-2">${formatBigInt(Math.round(e.areaInSqKm))} km<sup>2</sup></td>`)},renderNews=e=>{newsArticles.empty();const t=$('<h2 class="fs-5">Latest News</h2>'),a=$('<div id="news" class="carousel carousel-dark slide" data-bs-ride="true"></div>'),o=$('<div class="carousel-indicators">'),r=$('<div class="carousel-inner">'),s=$('<button class="carousel-control-prev" type="button" data-bs-target="#news" data-bs-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="false"></span><span class="visually-hidden">Previous</span></button>'),n=$('<button class="carousel-control-next" type="button" data-bs-target="#news" data-bs-slide="next"><span class="carousel-control-next-icon" aria-hidden="false"></span><span class="visually-hidden">Next</span></button>');if(newsArticles.append(t,a),a.append(o,r,s,n),e&&e.length>0)e.forEach(((e,t)=>{const a=$(`<button type="button" data-bs-target="#news" data-bs-slide-to="${t}"${0===t?' class="active" aria-current="true"':""} aria-label="Slide 1"></button>`),s=$(`<figure class="card px-5 pb-3 rounded-3 bg-light bg-gradient carousel-item${0===t?" active":""}"></figure>`),n=$(`<div class="card-body"><img src="${e.image}" alt="" /><h5 class="card-title mb-1">${e.title}</h5><small class="mb-1">published at ${new Date(e.publishedAt).toLocaleDateString()}</small><blockquote class="mb-1">${e.description}</blockquote><p class="card-text mb-1">${e.content}</p><small class="mb-1">by <i>${e.source.name}</i></small><a class="stretched-link" href="${e.url}" target="_blank" class="row g-0"><p class="card-text"><small class="text-muted">${e.url}</small></p></a></div>`);o.append(a),r.append(s),s.append(n)}));else{const e=$('<button type="button" data-bs-target="#news" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>'),t=$('<figure class="card px-5 pb-3 rounded-3 bg-light bg-gradient carousel-item active"></figure>'),a=$('<div class="card-body"><h5 class="card-title">No News Available</h5><p class="card-text">There\'s no news available for the current country.</p><a class="stretched-link" href="#" target="_blank" class="row g-0"><p class="card-text"><small class="text-muted"></small></p></a></div>');o.append(e),r.append(t),t.append(a)}},renderBaseLayerControls=(e,t)=>{t&&(baseLayerControl.empty(),baseLayerControlDropdown.empty()),e.on("input",(t=>{renderBaseLayerControls(e,!0)}));let a=null,o=[];e.each((t=>{const r=e[t],s=$(`<img src="${tiles[t].img}" alt="${tiles[t].name}" data-bs-toggle="tooltip" title="${tiles[t].name.split("").map(((e,t)=>0===t?e.toUpperCase():e)).join("")}"/>`);if(r.checked){const e=$('<button class="btn btn-clear border shadows" type="button"></button>');e.append(s,r),a=e,"Satellite"===s[0].title||"Dark"===s[0].title?crosshair.addClass("light"):crosshair.removeClass("light")}else{const e=$('<label class="btn btn-clear border shadows"></label>');e.append(s,r),o.push(e)}})),baseLayerControl.append(baseLayerControlDropdown),bottomRightControls.prepend(baseLayerControl),baseLayerControl.append(a),o.forEach((e=>baseLayerControlDropdown.prepend(e))),a.on("click",(()=>{collapse.toggle()})),baseLayerControl.mouseleave((e=>{collapse.hide()})),collapse.hide()},renderToast=(e={})=>{const{name:t="",src:a="",text:o="",delay:r}=e;let s=0,n=null;const i=$('<div class="toast shadows-light mb-1" role="alert" aria-live="assertive" aria-atomic="true"></div>'),l=$('<div class="toast-header"></div>'),c=$(`<img src="${a}" class="rounded me-2" alt="${t} Logo" />`),d=$(`<strong class="me-auto">${t}</strong>`);let p=$(`<small class="text-muted">${s} seconds ago</small>`);const u=$('<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>'),m=$(`<div class="toast-body">${o}</div>`),h=new bootstrap.Toast(i[0],{delay:12e3});u.on("click",(e=>{h.hide()})),toastContainer.append(i),i.append(l),i.append(m),l.append(c),l.append(d),l.append(p),l.append(u),h.show(),n=setInterval((()=>{s++,l.empty(),p=$(`<small class="text-muted">${s} seconds ago</small>`),l.append(c),l.append(d),l.append(p),l.append(u)}),1e3),i[0].addEventListener("hidden.bs.toast",(()=>{clearInterval(n),i.remove()}))},renderWeather=async e=>{const{description:t,feels_like:a,humidity:o,icon:r,pressure:s,temp:n,temp_max:i,temp_min:l}=e,c=(n+i+l)/3,d=$(`<span class="fs-1 bold ms-2">${Math.round(K.kelToCel(c))}<sup class="fs-6">°C</sup></span>`);let p=await fetch(`http://openweathermap.org/img/w/${r}.png`);p=await p.blob(),p=URL.createObjectURL(p),weatherContainer.empty(),weatherIcon.attr("src",p),weatherIcon.attr("alt",t),weatherContainer.append(weatherIcon),weatherContainer.append(d)},renderAlertAddress=e=>{currentAddressMarker.empty(),currentAddressMarker.html(icon);const t=e.results[0].formatted;currentAddressMarker.append($(`<div>${t}</div>`))},handleMapMoveEnd=e=>{moveTimeout&&clearTimeout(moveTimeout),moveTimeout=setTimeout((()=>{getCurrentLocation()}),1e3)},myLocationFound=()=>{myLocation.empty(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 45.9V42.15Q15.65 41.45 11.1 36.9Q6.55 32.35 5.85 25.5H2.1V22.5H5.85Q6.55 15.65 11.1 11.1Q15.65 6.55 22.5 5.85V2.1H25.5V5.85Q32.35 6.55 36.9 11.1Q41.45 15.65 42.15 22.5H45.9V25.5H42.15Q41.45 32.35 36.9 36.9Q32.35 41.45 25.5 42.15V45.9ZM24 39.2Q30.25 39.2 34.725 34.725Q39.2 30.25 39.2 24Q39.2 17.75 34.725 13.275Q30.25 8.8 24 8.8Q17.75 8.8 13.275 13.275Q8.8 17.75 8.8 24Q8.8 30.25 13.275 34.725Q17.75 39.2 24 39.2ZM24 31.5Q20.85 31.5 18.675 29.325Q16.5 27.15 16.5 24Q16.5 20.85 18.675 18.675Q20.85 16.5 24 16.5Q27.15 16.5 29.325 18.675Q31.5 20.85 31.5 24Q31.5 27.15 29.325 29.325Q27.15 31.5 24 31.5Z"/></svg>')},myLocationLeft=()=>{myLocation.empty(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 46V42.25Q15.65 41.55 11.1 37Q6.55 32.45 5.85 25.6H2.1V22.6H5.85Q6.55 15.75 11.1 11.2Q15.65 6.65 22.5 5.95V2.2H25.5V5.95Q32.35 6.65 36.9 11.2Q41.45 15.75 42.15 22.6H45.9V25.6H42.15Q41.45 32.45 36.9 37Q32.35 41.55 25.5 42.25V46ZM24 39.3Q30.25 39.3 34.725 34.825Q39.2 30.35 39.2 24.1Q39.2 17.85 34.725 13.375Q30.25 8.9 24 8.9Q17.75 8.9 13.275 13.375Q8.8 17.85 8.8 24.1Q8.8 30.35 13.275 34.825Q17.75 39.3 24 39.3Z"/></svg>')},toggleMenu=()=>{moreInfo.toggleClass("active"),bottomLeftControls.toggleClass("hide"),moreInfoCollape.toggle()},showGeoLayer=(e,t)=>{if(e){const a=geojson.features.filter((t=>t.properties.iso_a2.toLowerCase()===e.toLowerCase()));geoLayer&&geoLayer.removeFrom(map),geoLayer=L.geoJSON(a,{dashArray:"8,8",fillOpacity:.1,fillColor:"var(--bs-secondary)",color:"var(--bs-secondary)"}),geoLayer.bindTooltip(`<img class="flag mb-1" src="https://countryflagsapi.com/svg/${e.toLowerCase()}" alt=""/><p class="mb-0 fw-semibold lh-1">${t.countryName}</p><p class="mb-0 lh-1">${formatBigInt(t.population)} residents</p>`,{sticky:!0,direction:"bottom",offset:L.point(-12,16)}),geoLayer.addTo(map)}},hideGeoLayer=()=>{geoLayer.removeFrom(map),geoLayer=null},toggleGeoLayer=()=>{geoLayer?(geoLayer.removeFrom(map),geoLayer=null):showGeoLayer(currentCountry,centre.country)},toggleCrosshair=e=>{crosshairButton.toggleClass("active"),crosshair.toggleClass("hide")},isFullscreen=()=>null!==document.fullscreenElement,toggleFullscreen=()=>{isFullscreen()?document.exitFullscreen():document.querySelector("body").requestFullscreen()},handleMapClick=e=>{clickTimeout&&clearTimeout(clickTimeout),clickCount++,clickCount>1?clickCount=0:clickTimeout=setTimeout((()=>{Object.keys(markerLayerGroup._layers).length>0?($("#business-info")[0]&&$("#business-info").remove(),removeMarkers()):addLocationMarker(e),clickCount=0}),500)},addLocationMarker=(e,t)=>{const a=L.ExtraMarkers.icon({icon:t||"fa-circle",markerColor:"green",shape:"penta",prefix:"fa"}),o=L.marker(e,{icon:a,interactive:!0,zIndexOffset:1e3}).addTo(markerLayerGroup);window.innerWidth>1280&&!moreInfo.hasClass("active")&&toggleMenu(),locationMarkerLatLng=e,handleZoomEnd=()=>{moveTimeout&&clearTimeout(moveTimeout),moveTimeout=setTimeout((()=>{getCurrentLocation(e,o)}),1e3)},$("#business-info")[0]&&$("#business-info").remove(),setTimeout((()=>{1===Object.keys(markerLayerGroup._layers).length&&map.addEventListener("zoomend",handleZoomEnd)}),1e3),o.clickCount=0,getCurrentLocation(e,o),crosshair.fadeOut(),o.addEventListener("click",(e=>{$("#business-info")[0]&&$("#business-info").remove(),o.removeFrom(markerLayerGroup),handleRemovedMarker()})),map.removeEventListener("moveend",handleMapMoveEnd)},removeMarkers=()=>{markerLayerGroup.clearLayers(),handleRemovedMarker()},handleRemovedMarker=()=>{0===Object.keys(markerLayerGroup._layers).length&&(getCurrentLocation(),locationMarkerLatLng=null,crosshair.fadeIn(),map.removeEventListener("zoomend",handleZoomEnd),map.addEventListener("moveend",handleMapMoveEnd))},getMyLocationMarkers=(e,t)=>{const a=L.latLng(e.coords.latitude,e.coords.longitude),o=L.ExtraMarkers.icon({icon:"fa-user",markerColor:"blue",shape:"square",prefix:"fa"}),r=L.marker(a,{icon:o,zIndexOffset:999});r.bindTooltip(`<p class="mb-0">You're in ${prependTheToCountry(t.countryName)}</p>`,{direction:"bottom"}).openTooltip();const s=a.toBounds(e.coords.accuracy);return{latLng:a,marker:r,latLngBounds:s}},goToMyLocation=()=>{const e=()=>{myLocation.empty(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 45.9V42.15Q15.65 41.45 11.1 36.9Q6.55 32.35 5.85 25.5H2.1V22.5H5.85Q6.55 15.65 11.1 11.1Q15.65 6.55 22.5 5.85V2.1H25.5V5.85Q32.35 6.55 36.9 11.1Q41.45 15.65 42.15 22.5H45.9V25.5H42.15Q41.45 32.35 36.9 36.9Q32.35 41.45 25.5 42.15V45.9ZM24 39.2Q30.25 39.2 34.725 34.725Q39.2 30.25 39.2 24Q39.2 17.75 34.725 13.275Q30.25 8.8 24 8.8Q17.75 8.8 13.275 13.275Q8.8 17.75 8.8 24Q8.8 30.25 13.275 34.725Q17.75 39.2 24 39.2ZM24 31.5Q20.85 31.5 18.675 29.325Q16.5 27.15 16.5 24Q16.5 20.85 18.675 18.675Q20.85 16.5 24 16.5Q27.15 16.5 29.325 18.675Q31.5 20.85 31.5 24Q31.5 27.15 29.325 29.325Q27.15 31.5 24 31.5Z"/></svg>'),map.removeEventListener("moveend",e)};if(location&&location.latLngBounds||found){const t=location.country;map.fitBounds([[t.north,t.east],[t.south,t.west]]),map.addEventListener("moveend",e)}else{navigator.geolocation.getCurrentPosition((t=>{getCurrentAddress(t.coords.latitude,t.coords.longitude,(e=>{location={...location,data:e.results[0]},getCountryData(location.data.country_code,!1,(e=>{location={...location,country:e},location={...location,...getMyLocationMarkers(t,e)},location.layer=L.layerGroup([location.marker]).addTo(map),map.fitBounds([[e.north,e.east],[e.south,e.west]])}))})),found=!0,map.addEventListener("moveend",e)}),(e=>{renderNoLocation()}))}},convertExchangeRates=(e,t)=>{if("USD"!==e.toUpperCase()){const a=t.data.rates[e];t.data.rates.USD=Math.round(1e5*(1/a+Number.EPSILON))/1e5;for(let e in t.data.rates)t.data.rates[e]=Math.round(1e5*(t.data.rates[e]/a+Number.EPSILON))/1e5}else t.data.rates.USD=1;return currentExchangeRates=t.data.rates,t},extractForecastData=e=>{const t=[];let a=(new Date).getDay();for(let o=0;o<e.data.list.length;o+=8){const r=e.data.list[o];t.push({...r.weather[0],...r.main,day:K.getDayFromInt(a)}),a<6?a++:a=0}return t},addIconsToBusiness=e=>{const t=[];return e.categories.forEach((e=>{let{alias:a}=e;const o=e=>{e in categories?t.includes(e)||t.push(e):(e=allCategories[e].parent_aliases[0],o(e))};o(a)})),{...e,icons:t.map((e=>({img:categories[e].icon,colour:categories[e].colour})))}},addBusinessMarkers=e=>{businessLayerGroup.clearLayers(),e.businesses.forEach((e=>{let t="";new Array(Math.ceil(e.rating)).fill('<svg class="star" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>').forEach((e=>{t+=e}));const a=L.latLng(e.coordinates.latitude,e.coordinates.longitude),o=L.ExtraMarkers.icon({icon:e.icons[0].img,markerColor:e.icons[0].colour,shape:"circle",prefix:"fa"});L.marker(a,{icon:o}).addTo(businessLayerGroup).addEventListener("click",(o=>{Object.keys(markerLayerGroup._layers).length>0&&markerLayerGroup.clearLayers(),$("#business-info")[0]&&$("#business-info").remove(),moreInfo.hasClass("active")||toggleMenu(),addLocationMarker(a,e.icons[0].img);(e=>{const a=$('<div id="business-info" class="card mb-3"></div>'),o=$(`<div class="card-icons">${e.icons.map((e=>`<div class="${e.colour} border"><i class="fa-solid ${e.img}"></i></div>`)).join("")}</div>`),r=$(`<img class="card-img-top" src="${e.image_url}" alt=""/>`),s=$('<div class="card-body"></div>'),n=$(`<h2 class="card-title mb-1">${e.name}</h2>`),i=$(`<div class="rating mb-1" style="width: ${16*e.rating}px;">${t}</div>`),l=$(`<p class="mb-1">${e.display_phone}</p>`),c=e.location.display_address.length>0?`<p class="mb-2">${[...new Set(e.location.display_address)].join(", ")}</p>`:null,d=$(`<a href="${e.url}" target="_blank" class="btn btn-primary">More Info</a>`);a.append(o,r,s),s.append(n,i,l,c,d),infoBody.prepend(a)})(e)}))}))},formatBigInt=e=>{if((e=e.toString()).lengt<4)return e;e=e.split("").reverse();for(let t=3;t<e.length;t+=3)e[t]+=",";return e.reverse().join("")};let AJAXQueue=[];const pajax=({url:e,type:t,dataType:a,data:o})=>(0===AJAXQueue.length&&loader.fadeIn(),new Promise((r=>{const s=$.ajax({url:e,type:t,dataType:a,data:o,success:async e=>{r(e),AJAXQueue=AJAXQueue.filter((e=>e!==s)),0===AJAXQueue.length&&loader.fadeOut()},error:(e,t,a)=>handleAJAXErrors(e,t,a,s)});AJAXQueue.push(s)}))),handleAJAXErrors=(e,t,a,o)=>{AJAXQueue=AJAXQueue.filter((e=>e!==o)),0===AJAXQueue.length&&loader.fadeOut(),0!==e.status&&(console.error(e),console.error(t),console.error(a))},getCurrentAddress=async(e,t,a)=>{const o=await pajax({url:backendHost+"/api/reverse_geocoding.php",type:"GET",dataType:"json",data:{lat:e,lng:t}});return a&&a(o.data),o.data},getCountryData=async(e,t,a)=>{if(e&&e.toLowerCase()!==currentCountry.toLowerCase()){t&&(currentCountry=e);const o=await pajax({url:`${backendHost}/api/country_info.php`,type:"POST",dataType:"json",data:{country:e}});return a&&a(o.data[0]),o.data[0]}},getCitiesData=async(e,t,a)=>{let o=t?Math.ceil(t/7500):100;o=o>999?999:o;const r=await pajax({url:`${backendHost}/api/cities.php`,type:"POST",dataType:"json",data:{country:e,limit:o}});return a&&a(r.data),r.data[0]},getAirports=async(e,t,a)=>{let o=t?Math.ceil(t/1e4):100;o=o>200?200:o;const r=await pajax({url:`${backendHost}/api/airports.php`,type:"POST",dataType:"json",data:{country:e,limit:o}});return a&&a(r.data),r.data[0]},getExchangeRates=async(e,t)=>{if(e.toUpperCase()!==currentCurrency.toUpperCase()){currentCurrency=e.toUpperCase();let a=await pajax({url:backendHost+"/api/exchange_rates.php",type:"GET",dataType:"json"});return a=convertExchangeRates(e,a),t&&t({base:a.data.base,rates:a.data.rates,currency:e}),{base:a.data.base,rates:a.data.rates,currency:e}}},getWeather=async(e,t,a)=>{const o=await pajax({url:backendHost+"/api/weather.php",type:"GET",dataType:"json",data:{lat:e,lng:t}});return a&&a({...o.data.weather[0],...o.data.main}),{...o.data.weather[0],...o.data.main}},getNews=async(e,t)=>{const a=await pajax({url:backendHost+"/api/news.php",type:"GET",dataType:"json",data:{country:e}});return t&&t(a.data),a},getForecast=async(e,t,a)=>{let o=await pajax({url:backendHost+"/api/forecast.php",type:"GET",dataType:"json",data:{lat:e,lng:t}});return o=extractForecastData(o),a&&a(o),o},getWiki=async(e,t)=>{const a=e.getNorth(),o=e.getEast(),r=e.getSouth(),s=e.getWest(),n=await pajax({url:backendHost+"/api/wikipedia.php",type:"GET",dataType:"json",data:{n:a,e:o,s:r,w:s}});return t&&t(n.data),n.data},autocompleteAddresses=e=>{$.ajax({url:backendHost+"/api/address_autocomplete.php",type:"GET",dataType:"json",data:e,success:e=>renderResults(e.data.features?e.data.features:[],e.data.query?e.data.query:{}),error:handleAJAXErrors})},getBusinesses=async(e,{categories:t="",q:a=""}={},o)=>{const{lat:r,lng:s}=e,n=map.getBounds().getNorthEast();let i=Math.round(n.distanceTo(e));i=i>4e4?4e4:i;const l=i<=4e4?await pajax({url:backendHost+"/api/business_search.php",type:"GET",dataType:"json",data:{categories:t,lat:r,lng:s,q:a,radius:i}}):{data:{businesses:[]}};return l.data.businesses=l.data.businesses?l.data.businesses.map((e=>addIconsToBusiness(e))):[],o&&o(l.data),l.data},getEarthquakes=async(e,t)=>{const a=await pajax({url:backendHost+"/api/earthquakes.php",type:"GET",dataType:"json",data:e});return a.data.earthquakes=a.data.earthquakes.sort(((e,t)=>(e=e.datetime)>(t=t.datetime)?-1:e<t?1:0)),t&&t(a.data.earthquakes),a.data.earthquakes},prependTheToCountry=e=>("united"===e.slice(0,6).toLowerCase()&&(e=`the ${e}`),e),cityLayerGroup=L.markerClusterGroup({maxClusterRadius:36}),airportLayerGroup=L.markerClusterGroup({maxClusterRadius:36}),addCityMarkers=e=>{cityLayerGroup.clearLayers(),e.forEach((e=>{const t=L.ExtraMarkers.icon({icon:"fa-city",markerColor:"red",shape:"circle",prefix:"fa"}),a=L.marker(L.latLng(e.lat,e.lng),{icon:t}).addTo(cityLayerGroup);a.bindTooltip(`<p class="mb-0 fw-semibold">${e.name}</p><p class=mb-0>${e.fcodeName.slice(0,1).toUpperCase()+e.fcodeName.slice(1)}</p><p class=mb-0>${formatBigInt(e.population)} residents</p>`,{direction:"bottom",offset:L.point(-16,-8)}),a.addEventListener("click",(t=>{Object.keys(markerLayerGroup._layers).length>0&&markerLayerGroup.clearLayers(),addLocationMarker(L.latLng(e.lat,e.lng))}))}))},addAirportMarkers=e=>{e.forEach((e=>{const t=L.ExtraMarkers.icon({icon:"fa-plane",markerColor:"pink",shape:"circle",prefix:"fa"}),a=L.marker(L.latLng(e.lat,e.lng),{icon:t}).addTo(cityLayerGroup);a.bindTooltip(`<p class="mb-0 fw-semibold">${e.name}</p>`,{direction:"bottom",offset:L.point(-16,-8)}),a.addEventListener("click",(t=>{Object.keys(markerLayerGroup._layers).length>0&&markerLayerGroup.clearLayers(),addLocationMarker(L.latLng(e.lat,e.lng))}))}))},getCurrentLocation=(e,t)=>{AJAXQueue.forEach((e=>{e.abort()})),console.log("getting current location"),e=e||map.getCenter();const{lat:a,lng:o}=e;getCurrentAddress(a,o,(e=>{const a=e.results[0].country_code;centre.data=e.results[0],renderAlertAddress(e),renderMenuAddress(e.results[0]),a&&currentCountry.toLowerCase()!==a&&(getNews(a,(e=>{renderNews(e.articles)})),countrySelect.val(a.toUpperCase())),t&&t.bindTooltip(`<p class="mb-0 fw-bolder">${e.results[0].formatted}</p>Click the <svg class="inline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg> button to learn more about this location.`,{direction:"bottom"}).openTooltip(),getCountryData(a,!0,(e=>{const{areaInSqKm:t,countryName:o,north:r,south:s,east:n,west:i}=e;getCitiesData(a,t,(e=>{var o;o=e,cityLayerGroup.clearLayers(),o.forEach((e=>{const t=L.ExtraMarkers.icon({icon:"fa-city",markerColor:"red",shape:"circle",prefix:"fa"}),a=L.marker(L.latLng(e.lat,e.lng),{icon:t}).addTo(cityLayerGroup);a.bindTooltip(`<p class="mb-0 fw-semibold">${e.name}</p><p class=mb-0>${e.fcodeName.slice(0,1).toUpperCase()+e.fcodeName.slice(1)}</p><p class=mb-0>${formatBigInt(e.population)} residents</p>`,{direction:"bottom",offset:L.point(-16,-8)}),a.addEventListener("click",(t=>{Object.keys(markerLayerGroup._layers).length>0&&markerLayerGroup.clearLayers(),addLocationMarker(L.latLng(e.lat,e.lng))}))})),getAirports(a,t,(e=>{e.forEach((e=>{const t=L.ExtraMarkers.icon({icon:"fa-plane",markerColor:"pink",shape:"circle",prefix:"fa"}),a=L.marker(L.latLng(e.lat,e.lng),{icon:t}).addTo(cityLayerGroup);a.bindTooltip(`<p class="mb-0 fw-semibold">${e.name}</p>`,{direction:"bottom",offset:L.point(-16,-8)}),a.addEventListener("click",(t=>{Object.keys(markerLayerGroup._layers).length>0&&markerLayerGroup.clearLayers(),addLocationMarker(L.latLng(e.lat,e.lng))}))}))}))})),outline.hasClass("active")&&showGeoLayer(a,e),getEarthquakes({north:r,south:s,east:n,west:i},(e=>{e.length>0?renderToast({name:"Gazetteer",src:"./assets/images/logo192.png",text:`The most recent earthquake in ${prependTheToCountry(o)} was a magnitude of ${e[0].magnitude}, recorded on ${new Date(e[0].datetime).toDateString()}.`}):renderToast({name:"Gazetteer",src:"./assets/images/logo192.png",text:`There have been no recently reported earthquakes in ${o}.`})})),centre.country=e,renderCountryData(e),getExchangeRates(e.currencyCode,(e=>{centre.exchangeRates=e,renderExchangeRates(e)}))}))})),getBusinesses(e,{categories:selectedCategories.join(",")},(e=>{addBusinessMarkers(e)})),getWeather(a,o,(e=>{centre.weather=e,renderWeather(e)})),getForecast(a,o,(e=>{centre.forecast=e,renderMenuWeather(e)}));const r=map.getBounds();getWiki(r,(e=>{renderWikis(e)}))},renderMainElements=()=>{head.append(favicon,appletouchicon),root.append(mapContainer),root.append(loader,crosshair,topControls,bottomLeftControls,bottomRightControls),topControls.append(topLeftControls,topRightControls),map=L.map("map",{center:[51.505,-.09],maxBounds:[[-90,-180],[90,180]],maxBoundsViscosity:1,zoom:13,zoomControl:!1}),map.addEventListener("click",(e=>{var t;t=e.latlng,clickTimeout&&clearTimeout(clickTimeout),clickCount++,clickCount>1?clickCount=0:clickTimeout=setTimeout((()=>{Object.keys(markerLayerGroup._layers).length>0?($("#business-info")[0]&&$("#business-info").remove(),removeMarkers()):addLocationMarker(t),clickCount=0}),500)})),map.addEventListener("move",(e=>{myLocation.empty(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 46V42.25Q15.65 41.55 11.1 37Q6.55 32.45 5.85 25.6H2.1V22.6H5.85Q6.55 15.75 11.1 11.2Q15.65 6.65 22.5 5.95V2.2H25.5V5.95Q32.35 6.65 36.9 11.2Q41.45 15.75 42.15 22.6H45.9V25.6H42.15Q41.45 32.45 36.9 37Q32.35 41.55 25.5 42.25V46ZM24 39.3Q30.25 39.3 34.725 34.825Q39.2 30.35 39.2 24.1Q39.2 17.85 34.725 13.375Q30.25 8.9 24 8.9Q17.75 8.9 13.275 13.375Q8.8 17.85 8.8 24.1Q8.8 30.35 13.275 34.825Q17.75 39.3 24 39.3Z"/></svg>')})),map.addEventListener("moveend",handleMapMoveEnd),markerLayerGroup=L.layerGroup().addTo(map),tiles.forEach(((e,t)=>{const{attribution:a,href:o,img:r,key:s="",name:n}=e;baseLayers[n]=L.tileLayer(o+s,{detectRetina:!0,minZoom:3,maxZoom:19}),0===t&&baseLayers[n].addTo(map)})),map.addLayer(businessLayerGroup),map.addLayer(cityLayerGroup),renderCategorySelector(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor><path d="M22.5 46V42.25Q15.65 41.55 11.1 37Q6.55 32.45 5.85 25.6H2.1V22.6H5.85Q6.55 15.75 11.1 11.2Q15.65 6.65 22.5 5.95V2.2H25.5V5.95Q32.35 6.65 36.9 11.2Q41.45 15.75 42.15 22.6H45.9V25.6H42.15Q41.45 32.45 36.9 37Q32.35 41.55 25.5 42.25V46ZM24 39.3Q30.25 39.3 34.725 34.825Q39.2 30.35 39.2 24.1Q39.2 17.85 34.725 13.375Q30.25 8.9 24 8.9Q17.75 8.9 13.275 13.375Q8.8 17.85 8.8 24.1Q8.8 30.35 13.275 34.825Q17.75 39.3 24 39.3Z"/></svg>'),bottomRightControls.prepend(myLocation),root.append(moreInfoMenu),moreInfoMenu.append(info),info.append(infoHeader,infoBody,infoFooter),infoHeader.append(infoHeaderText,infoClose),infoBody.append(addressList,formattedAddress,countryState,countryInfo,menuWeather,newsArticles,currencyList,wikis),countryInfo.append(continent,capital,population,areaSqKm),infoFooter.append(powered,attrib);for(let e in attributions){let{img:t,href:a}=attributions[e];attrib.append($(`<a href="${a}" class="d-flex justify-content-center" target="_blank" title="${K.camelToTitle(e)}"><img src="${t}" alt="${K.camelToTitle(e)}" /></a>`))}moreInfoCollape.hide(),weatherContainer.append(weatherholder,weatherholder2),bottomLeftControls.prepend(weatherContainer),currentAddressMarker.html(icon),placeholders.append(placeholder,placeholder2),currentAddressMarker.append(placeholders),bottomLeftControls.append(currentAddressMarker)},renderControls=()=>{L.control.layers(baseLayers).addTo(map),bottomRightControls.append(zoomControls),zoomIn.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-zoom-in"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>'),zoomOut.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-zoom-out"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>'),zoomControls.append(zoomIn,zoomOut),moreInfo.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'),searchBar.prepend(moreInfo),outline.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pen-tool"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg>'),crosshairButton.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-crosshair"><circle cx="12" cy="12" r="10"></circle><line x1="22" y1="12" x2="18" y2="12"></line><line x1="6" y1="12" x2="2" y2="12"></line><line x1="12" y1="6" x2="12" y2="2"></line><line x1="12" y1="22" x2="12" y2="18"></line></svg>'),bottomRightControls.prepend(crosshairButton);const e=$(".leaflet-control-layers-base input").remove();$(".leaflet-control-layers.leaflet-control").remove(),renderBaseLayerControls(e),topLeftControls.append(searchBarContainer),searchBarContainer.append(searchBar),searchLabel.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>'),searchBar.append(countrySelect,searchLabel),fullscreenButton.html(maximize),searchBar.append(fullscreenButton),geojson.features.sort(((e,t)=>(e=e.properties.name)<(t=t.properties.name)?-1:e>t?1:0)),geojson.features.forEach((e=>{const t=e.properties.name,a=e.properties.iso_a2;countrySelect.append($(`<option value="${a}">${t}</option>`))})),topLeftControls.append(toastContainer)};$("body").on("fullscreenchange",(e=>{fullscreenButton.empty(),isFullscreen()?fullscreenButton.html(minmize):fullscreenButton.html(maximize)})),zoomIn.on("click",(e=>{map.zoomIn()})),zoomOut.on("click",(e=>{map.zoomOut()})),moreInfo.on("click",(e=>{toggleMenu()})),infoClose.on("click",(e=>{toggleMenu()})),myLocation.on("click",(e=>{location?goToMyLocation():renderNoLocation()})),outline.on("click",(e=>{outline.toggleClass("active"),geoLayer?(geoLayer.removeFrom(map),geoLayer=null):showGeoLayer(currentCountry,centre.country)})),crosshairButton.on("click",toggleCrosshair),fullscreenButton.on("click",(e=>{isFullscreen()?document.exitFullscreen():document.querySelector("body").requestFullscreen()})),countrySelect.on("change",(e=>{getCountryData(e.target.value,!1,(t=>{const{north:a,east:o,south:r,west:s}=t,n=L.latLng(a,o),i=L.latLng(r,s);1===Object.keys(markerLayerGroup._layers).length&&removeMarkers(),map.removeEventListener("moveend",handleMapMoveEnd),map.fitBounds(L.latLngBounds(n,i)),map.addEventListener("moveend",handleMapMoveEnd),addLocationMarker(L.latLng((a+r)/2,(o+s)/2)),outline.hasClass("active")&&showGeoLayer(e.target.value,t)}))})),$((()=>{renderMainElements(),renderControls(),preloader.addClass("hide"),renderToast({name:"Gazetteer",src:"./assets/images/logo192.png",text:'Welcome to Gazetteer. Click the <svg class="inline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg> button above at any point for more information about the coutry or location you\'re currently viewing.'}),goToMyLocation()}));
