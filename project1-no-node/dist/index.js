import"./modules/jquery/jquery.min.js";import"./modules/leaflet/leaflet.js";import"./modules/bootstrap/bootstrap.min.js";import K from"./modules/kaigen/kaigen.js";import currencies from"./assets/json/currencies.json"assert{type:"json"};import geojson from"./assets/geojson/countryBorders.geo.json"assert{type:"json"};import cats from"./assets/json/mainCategories.json"assert{type:"json"};import allCats from"./assets/json/categories.json"assert{type:"json"};import colours from"./assets/json/colours.json"assert{type:"json"};const attributions={bootstrap:{img:"./assets/images/attribution/bootstrap.png",href:"https://getbootstrap.com/"},esri:{img:"./assets/images/attribution/esriworldimages.png",href:"https://www.esri.com"},geoapify:{img:"./assets/images/attribution/geoapify.png",href:"https://www.geoapify.com"},geonames:{img:"./assets/images/attribution/geonames.png",href:"https://www.geonames.org"},gnews:{img:"./assets/images/attribution/gnews.png",href:"https://gnews.io"},jawg:{img:"./assets/images/attribution/jawgmaps.png",href:"http://jawg.io"},leaflet:{img:"./assets/images/attribution/leafletjs.png",href:"https://leafletjs.com"},openExchange:{img:"./assets/images/attribution/openexchangerates.png",href:"https://openexchangerates.org"},openWeather:{img:"./assets/images/attribution/openweather.png",href:"https://www.openweather.org"},thunderforest:{img:"./assets/images/attribution/thunderforest.png",href:"https://www.thunderforest.com"}},tiles=[{name:"terrain",img:"./assets/images/terrain.png",key:"0983b35182f944bf84d692bcae8fbc89",href:"https://tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey=",attribution:'<a href="https://www.thunderforest.com/" data-bs-toggle="tooltip" title="Tiles Courtesy of Thunderforest Maps" target="_blank" class="jawg-attrib">&copy; <b>Thunderforest</b>Maps</a> | <a href="https://www.openstreetmap.org/copyright" data-bs-toggle="tooltip" title="OpenStreetMap is open data licensed under ODbL" target="_blank" class="osm-attrib">&copy; OSM contributors</a>'},{name:"primary",img:"./assets/images/primary.png",key:"fvlhZyGiTztkqcQiO7ymVbhnINKH1ym3JjaKyBLHcmu28wCg5lts8D6rbjpYGQit",href:"https://tile.jawg.io/jawg-sunny/{z}/{x}/{y}.png?access-token=",attribution:'<a href="http://jawg.io" data-bs-toggle="tooltip" title="Tiles Courtesy of Jawg Maps" target="_blank" class="jawg-attrib">&copy; <b>Jawg</b>Maps</a> | <a href="https://www.openstreetmap.org/copyright" data-bs-toggle="tooltip" title="OpenStreetMap is open data licensed under ODbL" target="_blank" class="osm-attrib">&copy; OSM contributors</a>'},{name:"dark",key:"0983b35182f944bf84d692bcae8fbc89",img:"./assets/images/dark.png",href:"https://tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png?apikey=",attribution:'<a href="https://www.thunderforest.com/" data-bs-toggle="tooltip" title="Tiles Courtesy of Thunderforest Maps" target="_blank" class="jawg-attrib">&copy; <b>Thunderforest</b>Maps</a> | <a href="https://www.openstreetmap.org/copyright" data-bs-toggle="tooltip" title="OpenStreetMap is open data licensed under ODbL" target="_blank" class="osm-attrib">&copy; OSM contributors</a>'},{name:"satellite",img:"./assets/images/satellite.png",href:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:'<a href="https://www.arcgis.com/" data-bs-toggle="tooltip" title="Tiles Courtesy of Esri World Imagery" target="_blank" class="jawg-attrib">&copy; <b>Esri </b>World Imagery</a> | <a href="https://www.openstreetmap.org/copyright" data-bs-toggle="tooltip" title="OpenStreetMap is open data licensed under ODbL" target="_blank" class="osm-attrib">&copy; OSM contributors</a>'}],backendHost="http://www.aidanklee.co.uk";let map=null,baseLayers={},markerLayerGroup=null,businessLayerGroup=null,location=null,centre={},found=!1,currentCountry="",currentCurrency="",currentExchangeRates=null,geoLayer=null,moveTimeout=null,searchTimeout=null,selectedCategories=[];const head=$("head"),favicon=$('<link rel="icon" type="image/png" href="./assets/images/logo192.png"/>'),appletouchicon=$('<link rel="apple-touch-icon" sizes="192x192" type="image/png" href="./assets/images/logo192.png">'),preloader=$("#preloader"),root=$("#root"),mapContainer=$('<div id="map"></div>'),categoryContainer=$('<div id="categories"></div>'),crosshair=$('<svg id="crosshair" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-crosshair"><circle cx="12" cy="12" r="10"></circle><line x1="22" y1="12" x2="18" y2="12"></line><line x1="6" y1="12" x2="2" y2="12"></line><line x1="12" y1="6" x2="12" y2="2"></line><line x1="12" y1="22" x2="12" y2="18"></line></svg>'),loader=$('<div id="loader" class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>'),topControls=$('<div class="controls top"></div>'),bottomLeftControls=$('<div class="controls bottom-left"></div>'),bottomRightControls=$('<div class="controls bottom-right"></div>'),topLeftControls=$('<div class="left"></div>'),topRightControls=$('<div class="right"></div>'),zoomControls=$('<div id="zoom-control" class="btn-group-vertical shadows"></div>'),zoomIn=$('<button class="btn btn-primary border" type="button" data-bs-toggle="tooltip" title="Zoom In"></button>'),zoomOut=$('<button class="btn btn-light border" type="button" data-bs-toggle="tooltip" title="Zoom Out"></button>'),moreInfo=$('<button id="more-info" class="btn btn-secondary border round" data-bs-toggle="tooltip" title="More Info"></button>'),myLocation=$('<button id="my-location" class="btn btn-secondary border round" data-bs-toggle="tooltip" title="My Location"></button>'),outline=$('<button id="geolayer" class="btn btn-light border round active" data-bs-toggle="tooltip" title="My Location"></button>'),crosshairButton=$('<button id="crosshair-button" class="btn btn-light border round active" data-bs-toggle="tooltip" title="Crosshair"></button>'),baseLayerControl=$('<div id="base-layer-control"></div>'),baseLayerControlDropdown=$('<div class="collapse"></div>'),collapse=new bootstrap.Collapse(baseLayerControlDropdown,{toggle:!1}),searchBarContainer=$('<div id="search-bar-container" class="mb-2 rounded-pill"></div>'),searchBar=$('<div id="search-bar" class="input-group shadows"></div>'),searchResults=$('<div id="search-results" class="shadows-light"></div>'),resultsCollapse=new bootstrap.Collapse(searchResults),resultList=$('<div id="result-list" class="list-group"></div>'),input=$('<input id="q" type="text" class="form-control" placeholder="Go XPlore" aria-label="Search" autocomplete="off">'),countrySelect=$('<select id="country" class="form-select" aria-label=" aria-label="Country Select"></select>'),searchLabel=$('<label for="q" class="btn btn-light border" data-bs-toggle="tooltip" title="Search"></label>'),maximize='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-maximize"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>',minmize='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-minimize"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path></svg>',fullscreenButton=$('<button class="btn btn-secondary" type="button" data-bs-toggle="tooltip" title="Full Screen"></button>'),toastContainer=$('<div class="toast-container"></div>'),weatherContainer=$('<div id="weather-container" data-bs-toggle="tooltip" class="btn btn-light mb-1 rounded d-flex align-items-center shadows-light border" title="Weather"></div>'),weatherIcon=$('<img src="" alt="" />'),weatherholder='<div class="placeholder-glow"><span class="placeholder col-12"></span></div>',weatherholder2=weatherholder.slice(),currentAddressMarker=$('<div class="alert alert-light d-flex align-items-center border shadows-light" role="alert"></div>'),icon='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-map-pin"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',placeholder='<div class="placeholder-glow"><span class="placeholder col-12"></span></div>',placeholder2=placeholder.slice(),placeholders=$('<div class="placeholders"></div>'),moreInfoMenu=$('<div id="more-info-menu" class="rounded-end border-end border-2 shadows-light collapse"></div>'),moreInfoCollape=new bootstrap.Collapse(moreInfoMenu[0],{toggle:!1}),info=$('<div id="info"></div>'),infoHeader=$('<header class="modal-header"></header>'),infoHeaderText=$('<h1 class="fs-2 fw-semibold mb-0"></div>'),infoClose=$('<button type="button" class="btn-close" aria-label="Close"></button>'),infoBody=$('<div class="modal-body"></div>'),addressList=$('<h2 class="modal-title mb-0 fs-5">Address</h2>'),formattedAddress=$("<p></p>"),countryState=$('<h2 class="modal-title mb-0 fs-4"></h2>'),continent=$('<p class="mb-0"></p>'),capital=$('<p class="mb-0"></p>'),population=$('<p class="mb-0"></p>'),areaSqKm=$("<p></p>"),menuWeather=$('<div class="weather d-flex border mb-3"></div>'),newsArticles=$('<div class="news"></div>'),currencyList=$('<div class="currency mb-3"></div>'),wikis=$('<div class="wiki"></div>'),infoFooter=$('<div class="modal-footer d-block"></div>'),powered=$('<p class="fw-bold text-center">Powered By</p>'),attrib=$('<div id="attribution" class ="d-flex justify-content-center"></div>'),categories={},allCategories={};let colourIndex=0;cats.forEach((e=>{e.colour=colours[colourIndex],categories[e.alias]=e,colourIndex=9===colourIndex?0:colourIndex+1})),allCats.categories.forEach((e=>allCategories[e.alias]=e));const renderNoLocation=()=>{const e=$('<div class="location modal fade" tabindex="-1"></div>'),t=$('<div class="modal-dialog modal-dialog-centered"></div>'),a=$('<div class="modal-content"></div>'),o=$('<div class="modal-header"></div>'),s=$('<h5 class="modal-title">Location Services</h5>'),r=$('<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>'),n=$('<div class="modal-body"><p>You didn\'t enable your location services or they\'re not available on your device. We aim to tailor your experience based on your location.</p><p class="mb-0">If you want the best experience enable your location and click below. If not, feel free to XPlore!</p></div>'),l=$('<div class="modal-footer"></div>'),i=$('<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>'),c=$('<button type="button" class="btn btn-primary"><svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 46V42.25Q15.65 41.55 11.1 37Q6.55 32.45 5.85 25.6H2.1V22.6H5.85Q6.55 15.75 11.1 11.2Q15.65 6.65 22.5 5.95V2.2H25.5V5.95Q32.35 6.65 36.9 11.2Q41.45 15.75 42.15 22.6H45.9V25.6H42.15Q41.45 32.45 36.9 37Q32.35 41.55 25.5 42.25V46ZM24 39.3Q30.25 39.3 34.725 34.825Q39.2 30.35 39.2 24.1Q39.2 17.85 34.725 13.375Q30.25 8.9 24 8.9Q17.75 8.9 13.275 13.375Q8.8 17.85 8.8 24.1Q8.8 30.35 13.275 34.825Q17.75 39.3 24 39.3Z"/></svg></button>');root.append(e),e.append(t),t.append(a),a.append(o,n,l),o.append(s,r),l.append(i,c);const d=new bootstrap.Modal(e[0]);d.show(),getCurrentLocation(),c.on("click",(e=>{goToMyLocation(map),d.hide()}))},renderCategorySelector=()=>{categoryContainer.on("mousewheel",(e=>{categoryContainer[0].scrollLeft+=e.originalEvent.deltaY})),root.append(categoryContainer);for(let e in categories){e=categories[e];const t=$(`<button class="btn btn-sm ${e.colour} d-flex align-items-center rounded-pill border-0" value="${e.alias}">${e.icon}<p class="mb-0">${e.title}</p></button>`);categoryContainer.append(t),t.on("click",(a=>{t.toggleClass("active"),t.hasClass("active")?selectedCategories.push(e.alias):selectedCategories=selectedCategories.filter((t=>t!==e.alias)),getBusinesses(L.latLng(centre.data.lat,centre.data.lon),{categories:selectedCategories.join(",")},(e=>{addBusinessMarkers(e)}))}))}},renderMenuWeather=async e=>{const t=e[0],a=e.slice(1),o=$('<div class="left"></div>'),s=$('<div class="right"></div>'),r=$('<div class="top d-flex"></div>'),n=$('<div class="bottom"></div>'),l=async(e,t,a)=>{const{description:o,feels_like:s,humidity:r,icon:n,pressure:l,temp:i,temp_max:c,temp_min:d}=t;let p=await fetch(`http://openweathermap.org/img/w/${n}.png`);p=await p.blob(),p=URL.createObjectURL(p),e.empty();const u=$('<img src="" alt="" />');u.attr("src",p),u.attr("alt",o),e.append(u,`<div class="day">${a||t.day.slice(0,3)}</div>`,`<div class="temp bold">${Math.round(K.kelToCel(i))}<sup>°C</sup></div>`)};menuWeather.empty(),menuWeather.append(o,s),s.append(r,n),n.append(`<p>Real Feel: ${Math.round(K.kelToCel(t.feels_like))}<sup>°C</sup>.</p><p>${K.toTitle(t.description)}</p><p>Humidity: ${t.humidity}%</p>`),l(o,t,"Today"),a.forEach((e=>{const t=$("<div></div>");r.append(t),l(t,e)}))},renderExchangeRates=e=>{const{currency:t,rates:a}=e;currencyList.empty();const o=$(`<h2 class="d-flex align-items-center overflow-hidden">${t} <span class="d-inline badge rounded-pill bg-primary fw-semibold fs-6 ms-2">${currencies[t]}</span></h2>`),s=$("<div class='select-rates'></div>");["USD","EUR","JPY","GBP","AUD","CAD"].forEach((e=>{const t=$('<div class="d-flex pb-1"></div>'),a=$(`<input disabled class="rate" value="${currentExchangeRates[e].toFixed(5)}" />`),o=$('<select class="form-select form-select-sm rounded-pill"></select>');o.on("change",(e=>{a.val(currentExchangeRates[e.currentTarget.value].toFixed(5))})),s.append(t),t.append(a,o),Object.keys(currencies).forEach((t=>{o.append($(`<option value="${t}"${e===t?" selected":""}>${t}: ${currencies[t]}</option>`))}))})),currencyList.append(o,s)},renderWikis=async(e=[])=>{wikis.empty();const t=$('<h2 class="fs-5">Wikipedia</h2>'),a=$('<div id="wiki" class="carousel carousel-dark slide" data-bs-ride="true"></div>'),o=$('<div class="carousel-indicators">'),s=$('<div class="carousel-inner">'),r=$('<button class="carousel-control-prev" type="button" data-bs-target="#wiki" data-bs-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="false"></span><span class="visually-hidden">Previous</span></button>'),n=$('<button class="carousel-control-next" type="button" data-bs-target="#wiki" data-bs-slide="next"><span class="carousel-control-next-icon" aria-hidden="false"></span><span class="visually-hidden">Next</span></button>');if(wikis.append(t,a),a.append(o,s,r,n),e.length>0)e.forEach(((e,t)=>{const a=$(`<button type="button" data-bs-target="#wiki" data-bs-slide-to="${t}"${0===t?' class="active" aria-current="true"':""} aria-label="Slide 1"></button>`),r=$(`<figure class="card px-5 pb-3 rounded-3 bg-light bg-gradient carousel-item${0===t?" active":""}"></figure>`),n=$(`<div class="card-body"><h5 class="card-title">${e.title}</h5><p class="card-text">${e.summary}</p><a class="stretched-link" href="https://${e.wikipediaUrl}" target="_blank" class="row g-0"><p class="card-text"><small class="text-muted">${e.wikipediaUrl}</small></p></a></div>`);o.append(a),s.append(r),r.append(n)}));else{const e=$('<button type="button" data-bs-target="#wiki" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>'),t=$('<figure class="card px-5 pb-3 rounded-3 bg-light bg-gradient carousel-item active"></figure>'),a=$('<div class="card-body"><h5 class="card-title">No Wikipedia Links</h5><p class="card-text">There\'s no Wikipedia links available for the current location. Try zooming out, viewing a wider area may find more results.</p><a class="stretched-link" href="#" target="_blank" class="row g-0"><p class="card-text"><small class="text-muted"></small></p></a></div>');o.append(e),s.append(t),t.append(a)}},renderMenuAddress=e=>{infoHeaderText.html(e.address_line1),formattedAddress.html(`${e.address_line1}${e.city?`, ${e.city}`:""}${e.county?`, ${e.county}`:""}${e.postcode?`, ${e.postcode}`:""}`),countryState.html(`${e.country?e.country:e.address_line1}${e&&e.state&&e.state.includes("-Capital")||!e.state?"":`, <span class="fs-6">${e.state}</span>`}`)},renderCountryData=e=>{continent.html(`<span class="fw-bolder">Continent: </span>${e.continentName}`),capital.html(`<span class="fw-bolder">Capital City: </span>${e.capital}`),population.html(`<span class="fw-bolder">Population: </span>${formatBigInt(e.population)}`),areaSqKm.html(`<span class="fw-bolder">Land Area: </span>${formatBigInt(Math.round(e.areaInSqKm))} km<sup>2</sup>`)},renderNews=e=>{newsArticles.empty();const t=$('<h2 class="fs-5">Latest News</h2>'),a=$('<div id="news" class="carousel carousel-dark slide" data-bs-ride="true"></div>'),o=$('<div class="carousel-indicators">'),s=$('<div class="carousel-inner">'),r=$('<button class="carousel-control-prev" type="button" data-bs-target="#news" data-bs-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="false"></span><span class="visually-hidden">Previous</span></button>'),n=$('<button class="carousel-control-next" type="button" data-bs-target="#news" data-bs-slide="next"><span class="carousel-control-next-icon" aria-hidden="false"></span><span class="visually-hidden">Next</span></button>');if(newsArticles.append(t,a),a.append(o,s,r,n),e&&e.length>0)e.forEach(((e,t)=>{const a=$(`<button type="button" data-bs-target="#news" data-bs-slide-to="${t}"${0===t?' class="active" aria-current="true"':""} aria-label="Slide 1"></button>`),r=$(`<figure class="card px-5 pb-3 rounded-3 bg-light bg-gradient carousel-item${0===t?" active":""}"></figure>`),n=$(`<div class="card-body"><img src="${e.image}" alt="" /><h5 class="card-title mb-1">${e.title}</h5><small class="mb-1">published at ${new Date(e.publishedAt).toLocaleDateString()}</small><blockquote class="mb-1">${e.description}</blockquote><p class="card-text mb-1">${e.content}</p><small class="mb-1">by <i>${e.source.name}</i></small><a class="stretched-link" href="${e.url}" target="_blank" class="row g-0"><p class="card-text"><small class="text-muted">${e.url}</small></p></a></div>`);o.append(a),s.append(r),r.append(n)}));else{const e=$('<button type="button" data-bs-target="#news" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>'),t=$('<figure class="card px-5 pb-3 rounded-3 bg-light bg-gradient carousel-item active"></figure>'),a=$('<div class="card-body"><h5 class="card-title">No News Available</h5><p class="card-text">There\'s no news available for the current country.</p><a class="stretched-link" href="#" target="_blank" class="row g-0"><p class="card-text"><small class="text-muted"></small></p></a></div>');o.append(e),s.append(t),t.append(a)}},renderBaseLayerControls=(e,t)=>{t&&(baseLayerControl.empty(),baseLayerControlDropdown.empty()),e.on("input",(t=>{renderBaseLayerControls(e,!0)}));let a=null,o=[];e.each((t=>{const s=e[t],r=$(`<img src="${tiles[t].img}" alt="${tiles[t].name}" data-bs-toggle="tooltip" title="${tiles[t].name.split("").map(((e,t)=>0===t?e.toUpperCase():e)).join("")}"/>`);if(s.checked){const e=$('<button class="btn btn-clear border shadows" type="button"></button>');e.append(r,s),a=e,"Satellite"===r[0].title||"Dark"===r[0].title?crosshair.addClass("light"):crosshair.removeClass("light")}else{const e=$('<label class="btn btn-clear border shadows"></label>');e.append(r,s),o.push(e)}})),baseLayerControl.append(baseLayerControlDropdown),bottomRightControls.prepend(baseLayerControl),baseLayerControl.append(a),o.forEach((e=>baseLayerControlDropdown.prepend(e))),a.on("click",(()=>{collapse.toggle()})),baseLayerControl.mouseleave((e=>{collapse.hide()})),collapse.hide()},renderResults=(e,t)=>{if(resultList.empty(),e.length>0){e.forEach((e=>{const t=L.latLng(e.properties.lat,e.properties.lon),a=L.latLng(e.bbox[1],e.bbox[0]),o=L.latLng(e.bbox[3],e.bbox[2]),s=L.latLngBounds(a,o),r=e.properties.formatted,n=$('<button class="list-group-item list-group-item-action"></button>');new bootstrap.Tab(n);n.html(r),resultList.append(n),n.on("click",(e=>{const{lat:a,lng:o}=t;Object.keys(markerLayerGroup._layers).length>0&&markerLayerGroup.clearLayers(),addLocationMarker(t),getCurrentAddress(a,o,(e=>{renderToast({name:"XPlore",src:logo,text:`Moving to ${e.results[0].formatted}.`})})),goToLocation(t,s)}))})),searchResults.append(resultList);const t=$("#result-list .list-group-item");bootstrap.Tab.getInstance(t[0]).show(),t.each((e=>{const a=t[e];a.addEventListener("mouseover",(e=>{bootstrap.Tab.getInstance(a).show()}))})),resultsCollapse.show()}},renderToast=(e={})=>{const{name:t="",src:a="",text:o=""}=e;let s=0,r=null;const n=$('<div class="toast shadows-light mb-1" role="alert" aria-live="assertive" aria-atomic="true"></div>'),l=$('<div class="toast-header"></div>'),i=$(`<img src="${a}" class="rounded me-2" alt="${t} Logo" />`),c=$(`<strong class="me-auto">${t}</strong>`);let d=$(`<small class="text-muted">${s} seconds ago</small>`);const p=$('<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>'),u=$(`<div class="toast-body">${o}</div>`),g=new bootstrap.Toast(n[0],{delay:6e4});p.on("click",(e=>{g.hide()})),toastContainer.append(n),n.append(l),n.append(u),l.append(i),l.append(c),l.append(d),l.append(p),g.show(),r=setInterval((()=>{s++,l.empty(),d=$(`<small class="text-muted">${s} seconds ago</small>`),l.append(i),l.append(c),l.append(d),l.append(p)}),1e3),n[0].addEventListener("hidden.bs.toast",(()=>{clearInterval(r),n.remove()}))},renderWeather=async e=>{const{description:t,feels_like:a,humidity:o,icon:s,pressure:r,temp:n,temp_max:l,temp_min:i}=e,c=(n+l+i)/3,d=$(`<span class="fs-1 bold ms-2">${Math.round(K.kelToCel(c))}<sup class="fs-6">°C</sup></span>`);let p=await fetch(`http://openweathermap.org/img/w/${s}.png`);p=await p.blob(),p=URL.createObjectURL(p),weatherContainer.empty(),weatherIcon.attr("src",p),weatherIcon.attr("alt",t),weatherContainer.append(weatherIcon),weatherContainer.append(d)},renderAlertAddress=e=>{currentAddressMarker.empty(),currentAddressMarker.html(icon);const t=e.results[0].formatted;currentAddressMarker.append($(`<div>${t}</div>`))},handleMapMoveEnd=e=>{moveTimeout&&clearTimeout(moveTimeout),moveTimeout=setTimeout((()=>{getCurrentLocation()}),1e3)},myLocationFound=()=>{myLocation.empty(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 45.9V42.15Q15.65 41.45 11.1 36.9Q6.55 32.35 5.85 25.5H2.1V22.5H5.85Q6.55 15.65 11.1 11.1Q15.65 6.55 22.5 5.85V2.1H25.5V5.85Q32.35 6.55 36.9 11.1Q41.45 15.65 42.15 22.5H45.9V25.5H42.15Q41.45 32.35 36.9 36.9Q32.35 41.45 25.5 42.15V45.9ZM24 39.2Q30.25 39.2 34.725 34.725Q39.2 30.25 39.2 24Q39.2 17.75 34.725 13.275Q30.25 8.8 24 8.8Q17.75 8.8 13.275 13.275Q8.8 17.75 8.8 24Q8.8 30.25 13.275 34.725Q17.75 39.2 24 39.2ZM24 31.5Q20.85 31.5 18.675 29.325Q16.5 27.15 16.5 24Q16.5 20.85 18.675 18.675Q20.85 16.5 24 16.5Q27.15 16.5 29.325 18.675Q31.5 20.85 31.5 24Q31.5 27.15 29.325 29.325Q27.15 31.5 24 31.5Z"/></svg>')},myLocationLeft=()=>{myLocation.empty(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 46V42.25Q15.65 41.55 11.1 37Q6.55 32.45 5.85 25.6H2.1V22.6H5.85Q6.55 15.75 11.1 11.2Q15.65 6.65 22.5 5.95V2.2H25.5V5.95Q32.35 6.65 36.9 11.2Q41.45 15.75 42.15 22.6H45.9V25.6H42.15Q41.45 32.45 36.9 37Q32.35 41.55 25.5 42.25V46ZM24 39.3Q30.25 39.3 34.725 34.825Q39.2 30.35 39.2 24.1Q39.2 17.85 34.725 13.375Q30.25 8.9 24 8.9Q17.75 8.9 13.275 13.375Q8.8 17.85 8.8 24.1Q8.8 30.35 13.275 34.825Q17.75 39.3 24 39.3Z"/></svg>')},toggleMenu=()=>{moreInfo.toggleClass("active"),bottomLeftControls.toggleClass("hide"),moreInfoCollape.toggle()},showGeoLayer=e=>{if(e){const t=geojson.features.filter((t=>t.properties.iso_a2.toLowerCase()===e.toLowerCase()));geoLayer&&geoLayer.removeFrom(map),geoLayer=L.geoJSON(t,{fillOpacity:0,color:"var(--bs-primary)"}).addTo(map)}},hideGeoLayer=()=>{geoLayer.removeFrom(map),geoLayer=null},toggleGeoLayer=()=>{geoLayer?(geoLayer.removeFrom(map),geoLayer=null):showGeoLayer(currentCountry)},toggleCrosshair=e=>{crosshairButton.toggleClass("active"),crosshair.toggleClass("hide")},isFullscreen=()=>null!==document.fullscreenElement,toggleFullscreen=()=>{isFullscreen()?document.exitFullscreen():document.querySelector("body").requestFullscreen()},handleMapClick=e=>{Object.keys(markerLayerGroup._layers).length>0?($("#business-info")[0]&&$("#business-info").remove(),removeMarkers()):addLocationMarker(e)},addLocationMarker=(e,t='<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.65 34h3V22h-3ZM24 18.3q.7 0 1.175-.45.475-.45.475-1.15t-.475-1.2Q24.7 15 24 15q-.7 0-1.175.5-.475.5-.475 1.2t.475 1.15q.475.45 1.175.45ZM24 44q-4.1 0-7.75-1.575-3.65-1.575-6.375-4.3-2.725-2.725-4.3-6.375Q4 28.1 4 23.95q0-4.1 1.575-7.75 1.575-3.65 4.3-6.35 2.725-2.7 6.375-4.275Q19.9 4 24.05 4q4.1 0 7.75 1.575 3.65 1.575 6.35 4.275 2.7 2.7 4.275 6.35Q44 19.85 44 24q0 4.1-1.575 7.75-1.575 3.65-4.275 6.375t-6.35 4.3Q28.15 44 24 44Zm.05-3q7.05 0 12-4.975T41 23.95q0-7.05-4.95-12T24 7q-7.05 0-12.025 4.95Q7 16.9 7 24q0 7.05 4.975 12.025Q16.95 41 24.05 41ZM24 24Z"/></svg>')=>{const a=L.divIcon({className:"pin1 secondary",iconSize:[48,48],html:t}),o=L.marker(e,{icon:a,interactive:!0}).addTo(markerLayerGroup);$("#business-info")[0]&&$("#business-info").remove(),1===Object.keys(markerLayerGroup._layers).length&&map.addEventListener("zoomend",(()=>{moveTimeout&&clearTimeout(moveTimeout),moveTimeout=setTimeout((()=>{getCurrentLocation(e)}),1e3)})),o.clickCount=0,getCurrentLocation(e),crosshair.fadeOut(),o.addEventListener("click",(e=>{$("#business-info")[0]&&$("#business-info").remove(),o.removeFrom(markerLayerGroup),handleRemovedMarker()})),map.removeEventListener("moveend",handleMapMoveEnd)},removeMarkers=()=>{markerLayerGroup.clearLayers(),handleRemovedMarker()},handleRemovedMarker=()=>{0===Object.keys(markerLayerGroup._layers).length&&(getCurrentLocation(),crosshair.fadeIn(),map.removeEventListener("zoomend",(()=>getCurrentLocation(latLng))),map.addEventListener("moveend",handleMapMoveEnd))},getMyLocationMarkers=e=>{const t=L.latLng(e.coords.latitude,e.coords.longitude),a=L.divIcon({className:"pin1",iconSize:[48,48],html:'<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewBox="0 0 48 48" fill="currentcolor"><path d="M11.1 35.25Q14.25 33.05 17.35 31.875Q20.45 30.7 24 30.7Q27.55 30.7 30.675 31.875Q33.8 33.05 36.95 35.25Q39.15 32.55 40.075 29.8Q41 27.05 41 24Q41 16.75 36.125 11.875Q31.25 7 24 7Q16.75 7 11.875 11.875Q7 16.75 7 24Q7 27.05 7.95 29.8Q8.9 32.55 11.1 35.25ZM24 25.5Q21.1 25.5 19.125 23.525Q17.15 21.55 17.15 18.65Q17.15 15.75 19.125 13.775Q21.1 11.8 24 11.8Q26.9 11.8 28.875 13.775Q30.85 15.75 30.85 18.65Q30.85 21.55 28.875 23.525Q26.9 25.5 24 25.5ZM24 44Q19.9 44 16.25 42.425Q12.6 40.85 9.875 38.125Q7.15 35.4 5.575 31.75Q4 28.1 4 24Q4 19.85 5.575 16.225Q7.15 12.6 9.875 9.875Q12.6 7.15 16.25 5.575Q19.9 4 24 4Q28.15 4 31.775 5.575Q35.4 7.15 38.125 9.875Q40.85 12.6 42.425 16.225Q44 19.85 44 24Q44 28.1 42.425 31.75Q40.85 35.4 38.125 38.125Q35.4 40.85 31.775 42.425Q28.15 44 24 44ZM24 41Q26.75 41 29.375 40.2Q32 39.4 34.55 37.4Q32 35.6 29.35 34.65Q26.7 33.7 24 33.7Q21.3 33.7 18.65 34.65Q16 35.6 13.45 37.4Q16 39.4 18.625 40.2Q21.25 41 24 41ZM24 22.5Q25.7 22.5 26.775 21.425Q27.85 20.35 27.85 18.65Q27.85 16.95 26.775 15.875Q25.7 14.8 24 14.8Q22.3 14.8 21.225 15.875Q20.15 16.95 20.15 18.65Q20.15 20.35 21.225 21.425Q22.3 22.5 24 22.5ZM24 18.65Q24 18.65 24 18.65Q24 18.65 24 18.65Q24 18.65 24 18.65Q24 18.65 24 18.65Q24 18.65 24 18.65Q24 18.65 24 18.65Q24 18.65 24 18.65Q24 18.65 24 18.65ZM24 37.35Q24 37.35 24 37.35Q24 37.35 24 37.35Q24 37.35 24 37.35Q24 37.35 24 37.35Q24 37.35 24 37.35Q24 37.35 24 37.35Q24 37.35 24 37.35Q24 37.35 24 37.35Z"/></svg>'}),o=L.marker(t,{icon:a}),s=L.circle(t,{radius:e.coords.accuracy,color:"#0d6efd",fillOpacity:.08}),r=t.toBounds(e.coords.accuracy);return{latLng:t,marker:o,circle:s,latLngBounds:r}},goToMyLocation=()=>{navigator.geolocation.getCurrentPosition((e=>{location=getMyLocationMarkers(e),getCurrentAddress(e.coords.latitude,e.coords.longitude,(e=>{location={...location,data:e.results[0]},getCountryData(location.data.country_code,!1,(e=>{location={...location,country:e}}))})),map.flyToBounds(location.latLngBounds);const t=()=>{if(location&&!found){const{latitude:t,longitude:a}=e.coords;location.circle.addTo(map),location.marker.addTo(map),getCurrentAddress(t,a,(t=>{renderToast({name:"XPlore",src:"./assets/images/logo192.png",text:`Hey! We think we've found your location within ${Math.round(e.coords.accuracy)}m of ${t.results[0].formatted}.`})})),found=!0}myLocation.empty(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 45.9V42.15Q15.65 41.45 11.1 36.9Q6.55 32.35 5.85 25.5H2.1V22.5H5.85Q6.55 15.65 11.1 11.1Q15.65 6.55 22.5 5.85V2.1H25.5V5.85Q32.35 6.55 36.9 11.1Q41.45 15.65 42.15 22.5H45.9V25.5H42.15Q41.45 32.35 36.9 36.9Q32.35 41.45 25.5 42.15V45.9ZM24 39.2Q30.25 39.2 34.725 34.725Q39.2 30.25 39.2 24Q39.2 17.75 34.725 13.275Q30.25 8.8 24 8.8Q17.75 8.8 13.275 13.275Q8.8 17.75 8.8 24Q8.8 30.25 13.275 34.725Q17.75 39.2 24 39.2ZM24 31.5Q20.85 31.5 18.675 29.325Q16.5 27.15 16.5 24Q16.5 20.85 18.675 18.675Q20.85 16.5 24 16.5Q27.15 16.5 29.325 18.675Q31.5 20.85 31.5 24Q31.5 27.15 29.325 29.325Q27.15 31.5 24 31.5Z"/></svg>'),map.removeEventListener("zoomend",t)};map.addEventListener("zoomend",t)}),(e=>{renderNoLocation()}))},goToLocation=(e,t)=>{map.flyToBounds(t)},convertExchangeRates=(e,t)=>{if("USD"!==e.toUpperCase()){const a=t.data.rates[e];t.data.rates.USD=Math.round(1e5*(1/a+Number.EPSILON))/1e5;for(let e in t.data.rates)t.data.rates[e]=Math.round(1e5*(t.data.rates[e]/a+Number.EPSILON))/1e5}else t.data.rates.USD=1;return currentExchangeRates=t.data.rates,t},extractForecastData=e=>{const t=[];let a=(new Date).getDay();for(let o=0;o<e.data.list.length;o+=8){const s=e.data.list[o];t.push({...s.weather[0],...s.main,day:K.getDayFromInt(a)}),a<6?a++:a=0}return t},addIconsToBusiness=e=>{const t=[];return e.categories.forEach((e=>{let{alias:a}=e;const o=e=>{e in categories?t.includes(e)||t.push(e):(e=allCategories[e].parent_aliases[0],o(e))};o(a)})),{...e,icons:t.map((e=>({img:categories[e].icon,colour:categories[e].colour})))}},addBusinessMarkers=e=>{businessLayerGroup?businessLayerGroup.clearLayers():businessLayerGroup=L.layerGroup().addTo(map),e.businesses.forEach((e=>{let t="";new Array(Math.ceil(e.rating)).fill('<svg class="star" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>').forEach((e=>{t+=e}));const a=L.latLng(e.coordinates.latitude,e.coordinates.longitude),o=L.divIcon({className:`business ${e.icons[0].colour}`,iconSize:[48,48],html:e.icons[0].img+`<div class="business-data card"><img src="${e.image_url}" alt=""/><div class="card-body"><p class="fs-6 fw-semibold mb-1 lh-1">${e.name}</p><div class="rating mb-1" style="width: ${16*e.rating}px;">${t}</div>${e.location.display_address.length>0?[...new Set(e.location.display_address.map((e=>`<p class="mb-0">${e}</p>`)))].join(""):null}</div></div>`});L.marker(a,{icon:o,interactive:!0}).addTo(businessLayerGroup).addEventListener("click",(o=>{Object.keys(markerLayerGroup._layers).length>0&&markerLayerGroup.clearLayers(),addLocationMarker(a,e.icons[0].img),moreInfo.hasClass("active")||toggleMenu();(e=>{const a=$('<div id="business-info" class="card mb-3"></div>'),o=$(`<div class="card-icons">${e.icons.map((e=>`<div class="${e.colour} border">${e.img}</div>`)).join("")}</div>`),s=$(`<img class="card-img-top" src="${e.image_url}" alt=""/>`),r=$('<div class="card-body"></div>'),n=$(`<h2 class="card-title mb-1">${e.name}</h2>`),l=$(`<div class="rating mb-1" style="width: ${16*e.rating}px;">${t}</div>`),i=$(`<p class="mb-1">${e.display_phone}</p>`),c=e.location.display_address.length>0?`<p class="mb-2">${[...new Set(e.location.display_address)].join(", ")}</p>`:null,d=$(`<a href="${e.url}" target="_blank" class="btn btn-primary">More Info</a>`);a.append(o,s,r),r.append(n,l,i,c,d),infoBody.prepend(a)})(e)}))}))},formatBigInt=e=>{if((e=e.toString()).lengt<4)return e;e=e.split("").reverse();for(let t=3;t<e.length;t+=3)e[t]+=",";return e.reverse().join("")};let AJAXQueue=[];const pajax=({url:e,type:t,dataType:a,data:o})=>(0===AJAXQueue.length&&loader.fadeIn(),new Promise((s=>{const r=$.ajax({url:e,type:t,dataType:a,data:o,success:async e=>{s(e),AJAXQueue=AJAXQueue.filter((e=>e!==r)),0===AJAXQueue.length&&loader.fadeOut()},error:(e,t,a)=>handleAJAXErrors(e,t,a,r)});AJAXQueue.push(r)}))),handleAJAXErrors=(e,t,a,o)=>{AJAXQueue=AJAXQueue.filter((e=>e!==o)),0===AJAXQueue.length&&loader.fadeOut(),0!==e.status&&(console.error(e),console.error(t),console.error(a))},getCurrentAddress=async(e,t,a)=>{const o=await pajax({url:backendHost+"/api/reverse_geocoding.php",type:"GET",dataType:"json",data:{lat:e,lng:t}});return a&&a(o.data),o.data},getCountryData=async(e,t,a)=>{if(e&&e.toLowerCase()!==currentCountry.toLowerCase()){t&&(currentCountry=e);const o=await pajax({url:`${backendHost}/api/country_info.php`,type:"POST",dataType:"json",data:{country:e}});return a&&a(o.data[0]),o.data[0]}},getExchangeRates=async(e,t)=>{if(e.toUpperCase()!==currentCurrency.toUpperCase()){currentCurrency=e.toUpperCase();let a=await pajax({url:backendHost+"/api/exchange_rates.php",type:"GET",dataType:"json"});return a=convertExchangeRates(e,a),t&&t({base:a.data.base,rates:a.data.rates,currency:e}),{base:a.data.base,rates:a.data.rates,currency:e}}},getWeather=async(e,t,a)=>{const o=await pajax({url:backendHost+"/api/weather.php",type:"GET",dataType:"json",data:{lat:e,lng:t}});return a&&a({...o.data.weather[0],...o.data.main}),{...o.data.weather[0],...o.data.main}},getNews=async(e,t)=>{const a=await pajax({url:backendHost+"/api/news.php",type:"GET",dataType:"json",data:{country:e}});return t&&t(a.data),a},getForecast=async(e,t,a)=>{let o=await pajax({url:backendHost+"/api/forecast.php",type:"GET",dataType:"json",data:{lat:e,lng:t}});return o=extractForecastData(o),a&&a(o),o},getWiki=async(e,t)=>{const a=e.getNorth(),o=e.getEast(),s=e.getSouth(),r=e.getWest(),n=await pajax({url:backendHost+"/api/wikipedia.php",type:"GET",dataType:"json",data:{n:a,e:o,s:s,w:r}});return t&&t(n.data),n.data},autocompleteAddresses=e=>{$.ajax({url:backendHost+"/api/address_autocomplete.php",type:"GET",dataType:"json",data:e,success:e=>renderResults(e.data.features||[],e.data.query),error:handleAJAXErrors})},getBusinesses=async(e,{categories:t="",q:a=""}={},o)=>{const{lat:s,lng:r}=e,n=map.getBounds().getNorthEast();let l=Math.round(n.distanceTo(e));l=l>4e4&&l<5e4?4e4:l;const i=l<=4e4?await pajax({url:backendHost+"/api/business_search.php",type:"GET",dataType:"json",data:{categories:t,lat:s,lng:r,q:a,radius:l}}):{data:{businesses:[]}};return i.data.businesses=i.data.businesses?i.data.businesses.map((e=>addIconsToBusiness(e))):[],o&&o(i.data),i.data},getEarthquakes=async(e,t)=>{const a=await pajax({url:backendHost+"/api/earthquakes.php",type:"GET",dataType:"json",data:e});return a.data.earthquakes=a.data.earthquakes.sort(((e,t)=>(e=e.datetime)>(t=t.datetime)?-1:e<t?1:0)),t&&t(a.data.earthquakes),a.data.earthquakes},getCurrentLocation=e=>{AJAXQueue.forEach((e=>{e.abort()})),e=e||map.getCenter();const{lat:t,lng:a}=e;getCurrentAddress(t,a,(e=>{centre.data=e.results[0],renderAlertAddress(e),renderMenuAddress(e.results[0]),e.results[0].country_code&&currentCountry.toLowerCase()!==e.results[0].country_code&&(getNews(e.results[0].country_code,(e=>{renderNews(e.articles)})),countrySelect.val(e.results[0].country_code.toUpperCase()),outline.hasClass("active")&&showGeoLayer(e.results[0].country_code)),getCountryData(e.results[0].country_code,!0,(e=>{const{countryName:t,north:a,south:o,east:s,west:r}=e;getEarthquakes({north:a,south:o,east:s,west:r},(e=>{e.length>0?renderToast({name:"XPlore",src:"./assets/images/logo192.png",text:`The most recent earthquake in ${t} was a magnitude of ${e[0].magnitude}, recorded on ${new Date(e[0].datetime).toDateString()}.`}):renderToast({name:"XPlore",src:"./assets/images/logo192.png",text:`There have been no recently reported earthquakes in ${t}.`})})),centre.country=e,renderCountryData(e),getExchangeRates(e.currencyCode,(e=>{centre.exchangeRates=e,renderExchangeRates(e)}))}))})),getBusinesses(e,{categories:selectedCategories.join(",")},(e=>{addBusinessMarkers(e)})),getWeather(t,a,(e=>{centre.weather=e,renderWeather(e)})),getForecast(t,a,(e=>{centre.forecast=e,renderMenuWeather(e)}));const o=map.getBounds();getWiki(o,(e=>{renderWikis(e)}))},renderMainElements=()=>{head.append(favicon,appletouchicon),root.append(mapContainer),[loader,crosshair,topControls,bottomLeftControls,bottomRightControls].forEach((e=>{root.append(e)})),topControls.append(topLeftControls,topRightControls),map=L.map("map",{center:[51.505,-.09],maxBounds:[[-90,-180],[90,180]],maxBoundsViscosity:1,zoom:13,zoomControl:!1}),map.addEventListener("click",(e=>{handleMapClick(e.latlng)})),map.addEventListener("move",(e=>{myLocation.empty(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor"><path d="M22.5 46V42.25Q15.65 41.55 11.1 37Q6.55 32.45 5.85 25.6H2.1V22.6H5.85Q6.55 15.75 11.1 11.2Q15.65 6.65 22.5 5.95V2.2H25.5V5.95Q32.35 6.65 36.9 11.2Q41.45 15.75 42.15 22.6H45.9V25.6H42.15Q41.45 32.45 36.9 37Q32.35 41.55 25.5 42.25V46ZM24 39.3Q30.25 39.3 34.725 34.825Q39.2 30.35 39.2 24.1Q39.2 17.85 34.725 13.375Q30.25 8.9 24 8.9Q17.75 8.9 13.275 13.375Q8.8 17.85 8.8 24.1Q8.8 30.35 13.275 34.825Q17.75 39.3 24 39.3Z"/></svg>')})),map.addEventListener("zoomend",(e=>{map.getZoom()>10&&categoryContainer.hasClass("hidden")?categoryContainer.removeClass("hidden"):map.getZoom()<=10&&!categoryContainer.hasClass("hidden")&&categoryContainer.addClass("hidden")})),map.addEventListener("moveend",handleMapMoveEnd),markerLayerGroup=L.layerGroup().addTo(map),tiles.forEach(((e,t)=>{const{attribution:a,href:o,img:s,key:r="",name:n}=e;baseLayers[n]=L.tileLayer(o+r,{detectRetina:!0,minZoom:3,maxZoom:19}),0===t&&baseLayers[n].addTo(map)})),renderCategorySelector(),myLocation.html('<svg xmlns="http://www.w3.org/2000/svg" height="48" width="48" viewbox="0 0 48 48" fill="currentcolor><path d="M22.5 46V42.25Q15.65 41.55 11.1 37Q6.55 32.45 5.85 25.6H2.1V22.6H5.85Q6.55 15.75 11.1 11.2Q15.65 6.65 22.5 5.95V2.2H25.5V5.95Q32.35 6.65 36.9 11.2Q41.45 15.75 42.15 22.6H45.9V25.6H42.15Q41.45 32.45 36.9 37Q32.35 41.55 25.5 42.25V46ZM24 39.3Q30.25 39.3 34.725 34.825Q39.2 30.35 39.2 24.1Q39.2 17.85 34.725 13.375Q30.25 8.9 24 8.9Q17.75 8.9 13.275 13.375Q8.8 17.85 8.8 24.1Q8.8 30.35 13.275 34.825Q17.75 39.3 24 39.3Z"/></svg>'),bottomRightControls.prepend(myLocation),root.append(moreInfoMenu),moreInfoMenu.append(info),info.append(infoHeader,infoBody,infoFooter),infoHeader.append(infoHeaderText,infoClose),infoBody.append(addressList,formattedAddress,countryState,continent,capital,population,areaSqKm,menuWeather,newsArticles,currencyList,wikis),infoFooter.append(powered,attrib);for(let e in attributions){let{img:t,href:a}=attributions[e];attrib.append($(`<a href="${a}" class="d-flex justify-content-center" target="_blank" title="${K.camelToTitle(e)}"><img src="${t}" alt="${K.camelToTitle(e)}" /></a>`))}moreInfoCollape.hide(),weatherContainer.append(weatherholder,weatherholder2),bottomLeftControls.prepend(weatherContainer),currentAddressMarker.html(icon),placeholders.append(placeholder,placeholder2),currentAddressMarker.append(placeholders),bottomLeftControls.append(currentAddressMarker)},renderControls=()=>{L.control.layers(baseLayers).addTo(map),bottomRightControls.append(zoomControls),zoomIn.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-zoom-in"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>'),zoomOut.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-zoom-out"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>'),zoomControls.append(zoomIn,zoomOut),moreInfo.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'),bottomRightControls.prepend(moreInfo),outline.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pen-tool"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg>'),bottomRightControls.prepend(outline),crosshairButton.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-crosshair"><circle cx="12" cy="12" r="10"></circle><line x1="22" y1="12" x2="18" y2="12"></line><line x1="6" y1="12" x2="2" y2="12"></line><line x1="12" y1="6" x2="12" y2="2"></line><line x1="12" y1="22" x2="12" y2="18"></line></svg>'),bottomRightControls.prepend(crosshairButton);const e=$(".leaflet-control-layers-base input").remove();$(".leaflet-control-layers.leaflet-control").remove(),renderBaseLayerControls(e),topLeftControls.append(searchBarContainer),searchBarContainer.append(searchBar,searchResults),searchLabel.html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>'),searchBar.append(input,countrySelect,searchLabel),fullscreenButton.html(maximize),searchBar.append(fullscreenButton),geojson.features.sort(((e,t)=>(e=e.properties.name)<(t=t.properties.name)?-1:e>t?1:0)),geojson.features.forEach((e=>{const t=e.properties.name,a=e.properties.iso_a2;countrySelect.append($(`<option value="${a}">${t}</option>`))})),topLeftControls.append(toastContainer)};$("body").on("fullscreenchange",(e=>{fullscreenButton.empty(),isFullscreen()?fullscreenButton.html(minmize):fullscreenButton.html(maximize)})),zoomIn.on("click",(e=>{map.zoomIn()})),zoomOut.on("click",(e=>{map.zoomOut()})),moreInfo.on("click",(e=>{toggleMenu()})),infoClose.on("click",(e=>{toggleMenu()})),myLocation.on("click",(e=>{location?goToMyLocation(map):renderNoLocation()})),outline.on("click",(e=>{outline.toggleClass("active"),geoLayer?(geoLayer.removeFrom(map),geoLayer=null):showGeoLayer(currentCountry)})),crosshairButton.on("click",toggleCrosshair),input.on("focus",(e=>{countrySelect.addClass("hide"),resultsCollapse.show()})),input.on("blur",(e=>{countrySelect.removeClass("hide"),resultsCollapse.hide()})),input.on("input",(e=>{0===e.target.value.length&&resultsCollapse.hide(),searchTimeout&&clearTimeout(searchTimeout),searchTimeout=setTimeout((()=>{const t=K.getInputData(e);autocompleteAddresses(t)}),500)})),fullscreenButton.on("click",(e=>{isFullscreen()?document.exitFullscreen():document.querySelector("body").requestFullscreen()})),countrySelect.on("change",(e=>{getCountryData(e.target.value,!1,(t=>{const{north:a,east:o,south:s,west:r}=t,n=L.latLng(a,o),l=L.latLng(s,r);1===Object.keys(markerLayerGroup._layers).length&&removeMarkers(),map.flyToBounds(L.latLngBounds(n,l)),outline.hasClass("active")&&showGeoLayer(e.target.value),centre.country=t,renderCountryData(t),getExchangeRates(t.currencyCode,(e=>{renderExchangeRates(e)}))}))})),$((()=>{renderMainElements(),renderControls(),preloader.addClass("hide"),goToMyLocation(map)}));
